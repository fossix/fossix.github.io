<!doctype html><html><head>
<link rel=stylesheet href=/syntax.css>
<link rel=stylesheet href=https://stackpath.bootstrapcdn.com/bootstrap/4.1.3/css/bootstrap.min.css integrity=sha384-MCw98/SFnGE8fJT3GXwEOngsV7Zt27NXFoaoApmYm81iuXoPkFOJwJ8ERdknLPMO crossorigin=anonymous>
<link href=/fossix.css rel=stylesheet media=screen>
<title>
Fossix - Adding big numbers
</title>
<script data-ad-client=ca-pub-0086577717613608 async src=https://pagead2.googlesyndication.com/pagead/js/adsbygoogle.js></script>
<meta name=viewport content="width=device-width,initial-scale=1">
<meta charset=utf-8>
</head>
<body><nav class="navbar navbar-expand-lg navbar-dark bg-dark">
<a class=navbar-brand href=/>
<img src=/site-logo.png width=40 height=45 class="d-inline-block align-top" alt>
</a>
<button class=navbar-toggler type=button data-toggle=collapse data-target=#navbarSupportedContent aria-controls=navbarSupportedContent aria-expanded=false aria-label="Toggle navigation">
<span class=navbar-toggler-icon></span>
</button>
<div class="collapse navbar-collapse" id=navbarSupportedContent>
<ul class="navbar-nav mr-auto">
<li class="nav-item active">
<a class=nav-link href=/>Fossix
<span class=sr-only>(current)</span>
</a>
</li>
</ul>
<form class="form-inline my-2 my-lg-0" id=search>
<input class="form-control mr-sm-2" type=search placeholder=Search aria-label=Search id=searchString name=searchString>
<button class="btn btn-outline-success my-2 my-sm-0" type=submit name=googleSearchName value=Search>Search</button>
</form>
</div>
</nav>
<div class=container-fluid style=margin-top:25px>
<div class=row>
<div class=col-md-2>
<div class="list-group list-group-flush">
<a href=/ class="list-group-item list-group-item-action">
Home
</a>
<a href=/categories/snippets class="list-group-item list-group-item-action">
Snippets
</a>
<a href=/categories/blogs class="list-group-item list-group-item-action">
Blogs
</a>
<a href=/categories/articles class="list-group-item list-group-item-action">
Articles
</a>
<a href=/archive/ class="list-group-item list-group-item-action">
Archive
</a>
</div>
</div>
<div class=col-md-6>
<div class="row content-title">
<h1>Adding big numbers</h1>
</div>
<div class="alert alert-light">
<span class=badge>Posted on: 2 October, 2020</span>
<div class=float-right>
<span> By santosh</span>
</div>
</div>
<hr>
<p>One of the most frequent interview questions or excercise problem is how to add
arbitrarily large numbers. For example</p>
<pre><code>72345678898723456754489234667744553453453469 +
50965245089245673459076671243800945678976232
</code></pre>
<p>This number doesn&rsquo;t fit in any commercially available CPU registers, in fact,
these numbers are larger than what can fit in a 128 bit word. The maximum number
that can fit in a 128-bit register is <code>340282366920938463463374607431768211455</code>!
But many of the scientific and astronomical calculations will need to operate on
these kind of very large numbers. There are libraries to deal with this, like
the GMP library (<a href=https://gmplib.org/>GNU MP Bignum Library</a>). But lets not get
into it for now, we will try to figure out how to do this without any library
support.</p>
<p>We will start with the excercise/interview question, how to add two singly
linked lists.</p>
<p><em>Input</em>
: Pointer to two lists of single digits</p>
<p><em>Output</em>
: Pointer to a new list where each node is a digit of the summed value of two
nodes from each of the input nodes.</p>
<p>There are a couple of things that we should keep in mind</p>
<ul>
<li>The lists need not be of equal length</li>
<li>Remember to propagate the carry to the first node (most significant digit)</li>
</ul>
<p>The most easiest (and buggy) approach is to walk through the list, extract the
numbers, add it up and construct a list from it.</p>
<pre><code class=language-c>struct list *add_list(struct list *l1, struct list *l2)
{
	unsigned long long num1 = 0, num2 = 0;

	while (l1) {
		num1 = num1 * 10 + l1-&gt;data;
		l1 = l1-&gt;next;
	}

	while (l2) {
		num2 = num2 * 10 + l2-&gt;data;
		l2 = l2-&gt;next;
	}

	num3 = num1 + num2;

	return construct_list(num3);
}
</code></pre>
<p>It&rsquo;s easy to figure out why this code is buggy; even if the two numbers
extracted from the lists are smaller than 8 bytes (word size of a typical
computer), the sum can overflow, resulting in a wrong answer.</p>
<p>Since the numbers can be of different sizes and there can be a carry from the
next digit (this is important because we cannot go back to the previous digit if
there is a carry and want to add it back, remember this is a singly linked
list), two lists cannot be added from the beginning. How did we do it in our
school?</p>
<p><img src=/images/big-numbers-addition.png alt="Addition of two numbers"></p>
<p>It&rsquo;s obvious that the addition will have to be done from right to left, but that
is not possible since it is a singly linked list. What can be done is, reverse
both the list, do the addition and add the resulting digits to a new list.</p>
<pre><code class=language-c>struct node *add_list(struct node *l1, struct node *l2)
{
	struct node *rl1, *rl2, *l3 = NULL;
	unsigned carry = 0;

	rl1 = reverse_list(l1);
	rl2 = reverse_list(l2);
    
	while (rl1 || rl2) {
		unsigned d1 = rl1 ? rl1-&gt;data : 0,
			 d2 = rl2 ? rl2-&gt;data : 0,
			 d = d1 + d2;

		d += carry;
		carry = 0;

		if (d &gt;= 10) {
			carry = 1;
			d = d % 10;
		}

		append_node(&amp;l3, d);

		rl1 = rl1 ? rl1-&gt;next : NULL;
		rl2 = rl2 ? rl2-&gt;next : NULL;
	}

	if (carry)
		append_node(&amp;l3, 1);

	return l3;
}
</code></pre>
<p>This same logic can extended to add numbers which are represented as a string.</p>
<p>The reverse function by itself is an interview question. But that is easily done
with rearrangement of pointers.</p>
<p><img src=/images/big-numbers-reversing-list.png alt="Reversing a list"></p>
<p>The list reversing can be understood easily if we take only two nodes, make the
first node point to <code>NULL</code> and the second node point to the first.</p>
<pre><code class=language-c>/* we need a pointer to hold the next node, so as its not lost */
struct list *next = head-&gt;next;
head-&gt;next = NULL;
next-&gt;next = head;
</code></pre>
<p>From here all we need to do is extend to three nodes. Since the first node is
already reversed, we will move head to point to the next, and repeat the same
operation.</p>
<pre><code class=language-c>struct node *reverse_list(struct node *head)
{
	struct node *next, *prev = NULL;

	while (head) {
		next = head-&gt;next;
		head-&gt;next = prev;
		prev = head;
		head = next;
	}
	return prev;
}
</code></pre>
<p>This time we just used another pointer <code>prev</code> to keep track of the previous
node, instead of just assigning a <code>NULL</code>.</p>
<p>Coming back to the big number addition, though that was an elegant (??)
solution, it is sub-optimal. If it was a interview question we could just leave
it here.</p>
<p>Computers can do calculations on large numbers (64 bits or 128 bits) in one
single operation. Also the list holds one digit per node; even a short int is a
big waste of space for a single digit (4-bits are enough). The data size can be
reduced further using a char data type. Or we could just use the entire
<code>unsigned long long</code> data type (or whatever type the data is), so that we will
use less space and don&rsquo;t have to do digit by digit operation.</p>
<p>Now that we have moved from the interview exercise problem, let&rsquo;s not stick with
singly linked list. Doubly linked list is a more efficient data structure for
this problem (Arrays are better, to avoid some memory allocation complexities,
which we will see later we will stick with doubly linked lists for
now). Moreover we can move back to play with the carry. Here is how we can do
it.</p>
<ul>
<li>Start from the right most entry (end of the list) and add the new number</li>
<li>if the number overflows, place only the overflowed amount in the entry, and
add one to the previous node (or create one if one doesn&rsquo;t exist).</li>
</ul>
<p>To save memory , we can start with one element list and add a node as we
continue to overflow. We will look into this is a future post.</p>
<hr>
<div class=float-right>
<a href=https://fossix.org/tagsalgorithm class="badge badge-dark">algorithm</a>
<a href=https://fossix.org/tagsaddition class="badge badge-dark">addition</a>
<a href=https://fossix.org/tagsc class="badge badge-dark">C</a>
<a href=https://fossix.org/tagsgmp class="badge badge-dark">GMP</a>
<a href=https://fossix.org/tagsbignum class="badge badge-dark">bignum</a>
</div>
</div><script src=https://ajax.googleapis.com/ajax/libs/jquery/3.4.1/jquery.min.js></script>
<script src=/fossix.js></script>
<script src=//ajax.googleapis.com/ajax/libs/jqueryui/1.12.1/jquery-ui.min.js></script>
<script src=https://stackpath.bootstrapcdn.com/bootstrap/4.1.3/js/bootstrap.min.js integrity=sha384-ChfqqxuZUCnJSK3+MXmPNIyE6ZbWh2IMqE241rYiqJxyMiZ6OW/JmZQ5stwEULTy crossorigin=anonymous></script>
<hr>
<div class=container>
<div class=row>
<div class=mx-auto>
<ul class=nav>
<li class=nav-item>
<a class="nav-link text-muted" href=/about>About</a>
</li>
<li class=nav-item>
<a class="nav-link text-muted" href=/contact/>Contact</a>
</li>
<li class=nav-item>
<a class="nav-link text-muted" href=/privacy/>Privacy Policy</a>
</li>
</ul>
</div>
</div>
<div class=row>
<div class=mx-auto>
<p>Site design and logo and content &copy; fossix.org</p>
</div>
</div>
</div>
</div>
</div>
</body>
</html>