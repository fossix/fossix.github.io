<!doctype html><html><head>
<link rel=stylesheet href=/syntax.css>
<link rel=stylesheet href=https://stackpath.bootstrapcdn.com/bootstrap/4.1.3/css/bootstrap.min.css integrity=sha384-MCw98/SFnGE8fJT3GXwEOngsV7Zt27NXFoaoApmYm81iuXoPkFOJwJ8ERdknLPMO crossorigin=anonymous>
<link href=/fossix.css rel=stylesheet media=screen>
<title>
Fossix - Generate unique IDs
</title>
<script data-ad-client=ca-pub-0086577717613608 async src=https://pagead2.googlesyndication.com/pagead/js/adsbygoogle.js></script>
<meta name=viewport content="width=device-width,initial-scale=1">
<meta charset=utf-8>
</head>
<body><nav class="navbar navbar-expand-md navbar-dark bg-dark">
<a class=navbar-brand href=/>
<img src=/site-logo.png width=40 height=45 class="d-inline-block align-top" alt>
<span class=front-site-title>Fossix</span>
</a>
<button class=navbar-toggler type=button data-toggle=collapse data-target=#navbarSupportedContent aria-controls=navbarSupportedContent aria-expanded=false aria-label="Toggle navigation">
<span class=navbar-toggler-icon></span>
</button>
<div class="collapse navbar-collapse" id=navbarSupportedContent>
<ul class="navbar-nav mr-auto">
<li class=nav-item>
<a href=/categories/snippets class=nav-link>
Snippets
</a>
</li>
<li class=nav-item>
<a href=/categories/blogs class=nav-link>
Blogs
</a>
</li>
<li class=nav-item>
<a href=/categories/articles class=nav-link>
Articles
</a>
</li>
<li class=nav-item>
<a class=nav-link href=/archive/>
Archive
</a>
</li>
</ul>
</div>
</nav>
<div class=container-fluid style=margin-top:25px>
<div class=row>
<div class=col-lg-3>
</div>
<div class="col-lg-6 content">
<h1>Generate unique IDs</h1>
<div class=alert-light>
<div class=float-left>
<span class=badge>
18 March, 2017 | sab
</span>
</div>
<div class=float-right>
<a href=https://fossix.org/tags/c class="badge badge-light">#c</a>
<a href=https://fossix.org/tags/database class="badge badge-light">#database</a>
<a href=https://fossix.org/tags/algorithm class="badge badge-light">#algorithm</a>
</div>
<span class=badge> </span>
</div>
<p>Inspired by Instagram’s method to generate unique id’s. I just tried to write a
program which does the same. Before that, why this? In the case of Instagram,
they had their database sharded, with so many insertions in a second, each new
record needs a unique id where databases auto increment doesn’t work and also
place where you need to have id which are time sortable. The below is the
program and it’s explanation.</p>
<div class=highlight><pre tabindex=0 class=chroma><code class=language-c data-lang=c><span class=cp>#include</span><span class=cpf>&lt;stdio.h&gt;</span><span class=cp>
</span><span class=cp>#include</span><span class=cpf>&lt;sys/time.h&gt;</span><span class=cp>
</span><span class=cp></span>
<span class=kt>int</span> <span class=nf>main</span><span class=p>()</span>
<span class=p>{</span>
    <span class=kt>int</span> <span class=n>i</span><span class=p>;</span>

    <span class=k>for</span><span class=p>(</span><span class=n>i</span> <span class=o>=</span><span class=mi>0</span><span class=p>;</span><span class=n>i</span> <span class=o>&lt;</span> <span class=mi>32</span><span class=p>;</span> <span class=n>i</span><span class=o>++</span><span class=p>)</span>
      <span class=n>func</span><span class=p>(</span><span class=n>i</span><span class=p>);</span>

    <span class=k>return</span> <span class=mi>0</span><span class=p>;</span>
<span class=p>}</span>

<span class=kt>int</span> <span class=nf>func</span><span class=p>(</span><span class=kt>unsigned</span> <span class=kt>long</span> <span class=n>u_id</span><span class=p>)</span>
<span class=p>{</span>
    <span class=k>struct</span> <span class=n>timeval</span> <span class=n>t</span><span class=p>;</span>
    <span class=kt>unsigned</span> <span class=kt>long</span> <span class=n>id</span><span class=p>;</span>

    <span class=n>gettimeofday</span><span class=p>(</span><span class=o>&amp;</span><span class=n>t</span><span class=p>,</span><span class=nb>NULL</span><span class=p>);</span>
    <span class=n>id</span> <span class=o>=</span> <span class=p>(</span><span class=n>t</span><span class=p>.</span><span class=n>tv_sec</span> <span class=o>*</span> <span class=mi>1000</span> <span class=o>*</span> <span class=mi>1000</span><span class=p>)</span> <span class=o>+</span> <span class=p>(</span><span class=n>t</span><span class=p>.</span><span class=n>tv_usec</span> <span class=o>*</span> <span class=mi>1000</span><span class=p>)</span> <span class=o>&lt;&lt;</span> <span class=mi>42</span><span class=p>;</span>
    <span class=n>id</span> <span class=o>|=</span> <span class=p>(</span><span class=n>u_id</span> <span class=o>%</span> <span class=mi>16777216</span><span class=p>)</span> <span class=o>&lt;&lt;</span> <span class=mi>24</span><span class=p>;</span>
    <span class=n>printf</span><span class=p>(</span><span class=s>&#34;%lu</span><span class=se>\n</span><span class=s> &#34;</span><span class=p>,</span><span class=n>id</span><span class=p>);</span>

    <span class=k>return</span> <span class=mi>0</span><span class=p>;</span>
<span class=p>}</span>
</code></pre></div><p>The <code>main()</code> is self explanatory. <code>func()</code> uses the gettimeofday function to get
the time in seconds and microseconds (I am not sure about the epoch), both the
values are converted in milliseconds. I have used 42 bits to save the
milliseconds which roughly gives more than 4 years of unique ids, now that we
have a time sortable id, we can add the last 22 bits with a unique id like a
database generated one or a user-id. But managing the last few bits with other
attributes solves the real purpose.</p>
</div>
<div class=col-lg-3>
<div>
<h5>You might also like</h5>
<ul style=list-style-type:none>
<li class=box-list><a href=/articles/assembly-programming-intro/ class=item>Intro To Assembly Programming From A Dummy</a></li>
<li class=box-list><a href=/articles/big-number-addition/ class=item>Adding big numbers</a></li>
<li class=box-list><a href=/articles/program-compilation-an-introduction/ class=item>Program Compilation - An introduction</a></li>
<li class=box-list><a href=/articles/the-birth-of-a-process/ class=item>The Birth of a Process</a></li>
</ul>
</div>
</div><script src=https://ajax.googleapis.com/ajax/libs/jquery/3.4.1/jquery.min.js></script>
<script src=/fossix.js></script>
<script src=//ajax.googleapis.com/ajax/libs/jqueryui/1.12.1/jquery-ui.min.js></script>
<script src=https://stackpath.bootstrapcdn.com/bootstrap/4.1.3/js/bootstrap.min.js integrity=sha384-ChfqqxuZUCnJSK3+MXmPNIyE6ZbWh2IMqE241rYiqJxyMiZ6OW/JmZQ5stwEULTy crossorigin=anonymous></script>
<hr>
<div class=container>
<div class=row>
<div class=mx-auto>
<ul class=nav>
<li class=nav-item>
<a class="nav-link text-muted" href=/about>About</a>
</li>
<li class=nav-item>
<a class="nav-link text-muted" href=/contact/>Contact</a>
</li>
<li class=nav-item>
<a class="nav-link text-muted" href=/privacy/>Privacy Policy</a>
</li>
</ul>
</div>
</div>
<div class=row>
<div class=mx-auto>
<p>Site design and logo and content &copy; fossix.org</p>
</div>
</div>
</div>
</div>
</div>
</body>
</html>