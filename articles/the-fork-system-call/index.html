<!doctype html><html><head>
<link rel=stylesheet href=/syntax.css>
<link rel=stylesheet href=https://stackpath.bootstrapcdn.com/bootstrap/4.1.3/css/bootstrap.min.css integrity=sha384-MCw98/SFnGE8fJT3GXwEOngsV7Zt27NXFoaoApmYm81iuXoPkFOJwJ8ERdknLPMO crossorigin=anonymous>
<link href=/fossix.css rel=stylesheet media=screen>
<title>
Fossix - The fork() system call
</title>
<script data-ad-client=ca-pub-0086577717613608 async src=https://pagead2.googlesyndication.com/pagead/js/adsbygoogle.js></script>
<meta name=viewport content="width=device-width,initial-scale=1">
<meta charset=utf-8>
</head>
<body><nav class="navbar navbar-expand-md navbar-dark bg-dark">
<a class=navbar-brand href=/>
<img src=/site-logo.png width=40 height=45 class="d-inline-block align-top" alt>
<span class=front-site-title>Fossix</span>
</a>
<button class=navbar-toggler type=button data-toggle=collapse data-target=#navbarSupportedContent aria-controls=navbarSupportedContent aria-expanded=false aria-label="Toggle navigation">
<span class=navbar-toggler-icon></span>
</button>
<div class="collapse navbar-collapse" id=navbarSupportedContent>
<ul class="navbar-nav mr-auto">
<li class=nav-item>
<a href=/categories/snippets class=nav-link>
Snippets
</a>
</li>
<li class=nav-item>
<a href=/categories/blogs class=nav-link>
Blogs
</a>
</li>
<li class=nav-item>
<a href=/categories/articles class=nav-link>
Articles
</a>
</li>
<li class=nav-item>
<a class=nav-link href=/archive/>
Archive
</a>
</li>
</ul>
</div>
</nav>
<div class=container-fluid style=margin-top:25px>
<div class=row>
<div class=col-lg-3>
</div>
<div class="col-lg-6 content">
<h1>The fork() system call</h1>
<div class=alert-light>
<div class=float-left>
<span class=badge>
24 March, 2017 | santosh
</span>
</div>
<div class=float-right>
<a href=https://fossix.org/tagsprocess class="badge badge-light">#process</a>
<a href=https://fossix.org/tagsfork class="badge badge-light">#fork</a>
<a href=https://fossix.org/tagssyscall class="badge badge-light">#syscall</a>
</div>
<span class=badge> </span>
</div>
<hr>
<p>As we know system calls take us from the user-land to the kernel-land. As
mentioned earlier this article will describe even the very obvious details, so
pardon the gory details. The different things that happen in the kernel during
the start up of a process is what we will discuss in this section.</p>
<p>As seen in the last code listing, the shell does a <code>fork()</code> and calls exec
family of system calls to overlay the command image onto the newly created child
process’ address space. Once the <code>fork()</code> system call is called, the kernel
creates a copy of the executing process, during which the following happens:</p>
<ul>
<li><code>fork()</code> creates a new stack, and copies shared resources such as open file
descriptors.</li>
<li>the kernel checks for resource limit of the calling process. The resource
limits, like if the number of process created has exceeded the system set
limit for a user (<code>ulimit</code>)</li>
<li>resets the process statistics such as execution times</li>
<li>The process is given a new process ID and starts executing the newly created
process.</li>
</ul>
<p>In this context there is a copy-on-write policy. Ideally the child process and
the parent process (which had called <code>fork()</code>) should have different data
areas. But Linux for efficiency does not create a new data area for the child,
but uses the same area of the parent’s until one of the processes start writing
to it. Since this paper is not a kernel commentary, I have intentionally left
out some functions that are called internally by the kernel.</p>
<p>The state now is shown in the following diagram. As it is shown, fork returns
twice, once in the parent with return value of the child process PID and once in
the child with a return value of zero.</p>
<p>The newly created process is uniquely identified by the process ID (PID). This
process belongs to the same process group as the parent. The group ID is is used
for job control in shells. There is also another kind of ID called the session
ID. All processes in the same group will, generally be in the same session ID
unless the process calls <code>setsid()</code> system call. The current process ID and its
parent process ID can be found using the ps command.</p>
<div class=highlight><pre tabindex=0 class=chroma><code class=language-console data-lang=console><span class=go>ps -e
</span><span class=go></span><span class=gp>$ </span>ps -f
<span class=go>UID        PID  PPID  C STIME TTY          TIME CMD
</span><span class=go>santosh   3939 15592  0 Apr17 pts/3    00:00:03 bash
</span><span class=go>santosh  25841  3939  0 07:17 pts/3    00:00:00 ps -f
</span></code></pre></div><p>The parent process of all commands executed in a shell is the shell itself. So
far, our to be process, the code written above, has not yet come into our big
picture.</p>
<hr>
</div><script src=https://ajax.googleapis.com/ajax/libs/jquery/3.4.1/jquery.min.js></script>
<script src=/fossix.js></script>
<script src=//ajax.googleapis.com/ajax/libs/jqueryui/1.12.1/jquery-ui.min.js></script>
<script src=https://stackpath.bootstrapcdn.com/bootstrap/4.1.3/js/bootstrap.min.js integrity=sha384-ChfqqxuZUCnJSK3+MXmPNIyE6ZbWh2IMqE241rYiqJxyMiZ6OW/JmZQ5stwEULTy crossorigin=anonymous></script>
<hr>
<div class=container>
<div class=row>
<div class=mx-auto>
<ul class=nav>
<li class=nav-item>
<a class="nav-link text-muted" href=/about>About</a>
</li>
<li class=nav-item>
<a class="nav-link text-muted" href=/contact/>Contact</a>
</li>
<li class=nav-item>
<a class="nav-link text-muted" href=/privacy/>Privacy Policy</a>
</li>
</ul>
</div>
</div>
<div class=row>
<div class=mx-auto>
<p>Site design and logo and content &copy; fossix.org</p>
</div>
</div>
</div>
</div>
</div>
</body>
</html>