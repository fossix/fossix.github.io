<!doctype html><html><head>
<link rel=stylesheet href=/syntax.css>
<link rel=stylesheet href=https://stackpath.bootstrapcdn.com/bootstrap/4.1.3/css/bootstrap.min.css integrity=sha384-MCw98/SFnGE8fJT3GXwEOngsV7Zt27NXFoaoApmYm81iuXoPkFOJwJ8ERdknLPMO crossorigin=anonymous>
<link href=/fossix.css rel=stylesheet media=screen>
<title>
Fossix - Debuggin Linux Kernel using JTAG (In ARM)
</title>
<script data-ad-client=ca-pub-0086577717613608 async src=https://pagead2.googlesyndication.com/pagead/js/adsbygoogle.js></script>
<meta name=viewport content="width=device-width,initial-scale=1">
<meta charset=utf-8>
</head>
<body><nav class="navbar navbar-expand-md navbar-dark bg-dark">
<a class=navbar-brand href=/>
<img src=/site-logo.png width=40 height=45 class="d-inline-block align-top" alt>
<span class=front-site-title>Fossix</span>
</a>
<button class=navbar-toggler type=button data-toggle=collapse data-target=#navbarSupportedContent aria-controls=navbarSupportedContent aria-expanded=false aria-label="Toggle navigation">
<span class=navbar-toggler-icon></span>
</button>
<div class="collapse navbar-collapse" id=navbarSupportedContent>
<ul class="navbar-nav mr-auto">
<li class=nav-item>
<a href=/categories/snippets class=nav-link>
Snippets
</a>
</li>
<li class=nav-item>
<a href=/categories/blogs class=nav-link>
Blogs
</a>
</li>
<li class=nav-item>
<a href=/categories/articles class=nav-link>
Articles
</a>
</li>
<li class=nav-item>
<a class=nav-link href=/archive/>
Archive
</a>
</li>
</ul>
</div>
</nav>
<div class=container-fluid style=margin-top:25px>
<div class=row>
<div class=col-lg-3>
</div>
<div class="col-lg-6 content">
<h1>Debuggin Linux Kernel using JTAG (In ARM)</h1>
<div class=alert-light>
<div class=float-left>
<span class=badge>
19 July, 2014 | ruchin
</span>
</div>
<div class=float-right>
<a href=https://fossix.org/tags/linux class="badge badge-light">#linux</a>
<a href=https://fossix.org/tags/debugging class="badge badge-light">#debugging</a>
<a href=https://fossix.org/tags/trace32 class="badge badge-light">#trace32</a>
</div>
<span class=badge> </span>
</div>
<p>Build a kernel with symbols.</p>
<pre tabindex=0><code>make menuconfig
 -&gt; kernel hacking 
       -&gt; Select Compile the kernel with debug info.
</code></pre><p>This will create a elf image (vmlinux) with can be understood by the
<code>trace32</code>. The best choice is to use a uncompressed kernel. ake the following
changes to <code>cmm</code> files.</p>
<p>Remove the aborts. Aborts are normal after mmu is initalized, so if you let the
Debugger break for aborts, you will be aborting for ever. So remove the aborts</p>
<pre tabindex=0><code>TrOnchip.Set.PABORT OFF
TrOnchip.Set.DABORT OFF
</code></pre><p>For adding the Linux menu in <code>Trace32</code>, the following lines will help. The cmm
files for these are already available in the latest version of the <code>Trace32</code>.</p>
<pre tabindex=0><code>TASK.CONFIG linux
MENU.ReProgram linux
</code></pre><h1 id=load-the-kernel-into-your-regular-load-location>Load the kernel into your regular load location</h1>
<p>Using the following command</p>
<pre tabindex=0><code>data.load.elf c:\vmlinux /strippart 4 /gnu /sourcepath y:\kernel
</code></pre><p>For source code debugging you need to give the <code>/strippart</code>. If you are directly
running <code>Trace32</code> in linux and giving the path to your actual kernel image, then
it is not needed. But, most often our Trace32 environment is in windows. So we
need to give how many paths to the stripped from the elf path.</p>
<p>For e.g., If you have compiled the kernel from <code>/home/user1/proj1/kernel/</code> In
windows if your source is here <code>Y:\kernel</code> Then you should strip
<code>/home/user1/proj1/kernel/</code> which is <code>4</code>.</p>
<h2 id=when-do-you-need-to-jump-to-vmlinux>When do you need to jump to vmlinux?</h2>
<p>This is exactly after your <code>u-boot</code> jumps to kernel image after
decompressing. This could be tricky. Just check the u-boot logs and find where
the kerenl is decompressed. It could be some address like <code>0x00008000</code>. First,
put a “HW breakpoint”there. Once, you hit the breakpoint it means the U-Boot is
ready to jump to the kernel. At this moment change the kernel in the ram by
using d.load.elf command shown above. You should see the initial instructions in
<code>0x000080000</code>. These are the same instructions seen in
<code>arch/arm/kernel/head.S</code>. You can put some breakpoints now and stop the
execution flow.</p>
<p>For debugging interrupts the ISR’s are located in virtual address from
<code>0xFFFF0000</code>.</p>
</div>
<div class=col-lg-3>
<div>
<h5>You might also like</h5>
<ul style=list-style-type:none>
<li class=box-list><a href=/articles/call-stack-basics/ class=item>Call Stack for Beginners - Part 1</a></li>
<li class=box-list><a href=/articles/cointainers/ class=item>Writing containers in Linux</a></li>
<li class=box-list><a href=/articles/emacs-org-mode-productivity/ class=item>Emacs org-mode productivity</a></li>
<li class=box-list><a href=/articles/powerpc-kernel-development-on-qemu/ class=item>Kernel development using qemu</a></li>
<li class=box-list><a href=/articles/linux-interview-questions/ class=item>Linux Interview Questions</a></li>
</ul>
</div>
</div><script src=https://ajax.googleapis.com/ajax/libs/jquery/3.4.1/jquery.min.js></script>
<script src=/fossix.js></script>
<script src=//ajax.googleapis.com/ajax/libs/jqueryui/1.12.1/jquery-ui.min.js></script>
<script src=https://stackpath.bootstrapcdn.com/bootstrap/4.1.3/js/bootstrap.min.js integrity=sha384-ChfqqxuZUCnJSK3+MXmPNIyE6ZbWh2IMqE241rYiqJxyMiZ6OW/JmZQ5stwEULTy crossorigin=anonymous></script>
<hr>
<div class=container>
<div class=row>
<div class=mx-auto>
<ul class=nav>
<li class=nav-item>
<a class="nav-link text-muted" href=/about>About</a>
</li>
<li class=nav-item>
<a class="nav-link text-muted" href=/contact/>Contact</a>
</li>
<li class=nav-item>
<a class="nav-link text-muted" href=/privacy/>Privacy Policy</a>
</li>
</ul>
</div>
</div>
<div class=row>
<div class=mx-auto>
<p>Site design and logo and content &copy; fossix.org</p>
</div>
</div>
</div>
</div>
</div>
</body>
</html>